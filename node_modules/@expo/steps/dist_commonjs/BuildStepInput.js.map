{"version":3,"file":"BuildStepInput.js","sourceRoot":"","sources":["../src/BuildStepInput.ts"],"names":[],"mappings":";;;AACA,2CAAoD;AACpD,qDAA6D;AAgB7D,MAAa,cAAc;IASlB,MAAM,CAAC,cAAc,CAAC,MAAoC;QAC/D,OAAO,CAAC,GAAG,EAAE,eAAe,EAAE,EAAE,CAAC,IAAI,cAAc,CAAC,GAAG,EAAE,EAAE,GAAG,MAAM,EAAE,eAAe,EAAE,CAAC,CAAC;IAC3F,CAAC;IAED,YACmB,GAAqB,EACtC,EAAE,EAAE,EAAE,eAAe,EAAE,aAAa,EAAE,YAAY,EAAE,QAAQ,GAAG,IAAI,EAAwB;QAD1E,QAAG,GAAH,GAAG,CAAkB;QAGtC,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;QACb,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;QACvC,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;QACnC,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QACjC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;IAC3B,CAAC;IAED,IAAW,KAAK;;QACd,MAAM,QAAQ,GAAG,MAAA,IAAI,CAAC,MAAM,mCAAI,IAAI,CAAC,YAAY,CAAC;QAClD,IAAI,IAAI,CAAC,QAAQ,IAAI,QAAQ,KAAK,SAAS,EAAE;YAC3C,MAAM,IAAI,iCAAqB,CAC7B,oBAAoB,IAAI,CAAC,EAAE,eAAe,IAAI,CAAC,eAAe,mCAAmC,CAClG,CAAC;SACH;QAED,IAAI,QAAQ,KAAK,SAAS,EAAE;YAC1B,OAAO,QAAQ,CAAC;SACjB;aAAM;YACL,OAAO,IAAA,oCAAsB,EAAC,QAAQ,EAAE,CAAC,IAAI,EAAE,EAAE,WAAC,OAAA,MAAA,IAAI,CAAC,GAAG,CAAC,kBAAkB,CAAC,IAAI,CAAC,mCAAI,EAAE,CAAA,EAAA,CAAC,CAAC;SAC5F;IACH,CAAC;IAEM,GAAG,CAAC,KAAyB;QAClC,IAAI,IAAI,CAAC,QAAQ,IAAI,KAAK,KAAK,SAAS,EAAE;YACxC,MAAM,IAAI,iCAAqB,CAC7B,oBAAoB,IAAI,CAAC,EAAE,eAAe,IAAI,CAAC,eAAe,gBAAgB,CAC/E,CAAC;SACH;QACD,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,yBAAyB;;QAC9B,MAAM,KAAK,GAAG,MAAA,IAAI,CAAC,MAAM,mCAAI,IAAI,CAAC,YAAY,CAAC;QAC/C,IAAI,IAAI,CAAC,aAAa,KAAK,SAAS,IAAI,KAAK,KAAK,SAAS,EAAE;YAC3D,OAAO,IAAI,CAAC;SACb;QACD,OAAO,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;IAC5C,CAAC;CACF;AAxDD,wCAwDC;AAED,SAAgB,yBAAyB,CAAC,MAAyB;IACjE,IAAI,MAAM,KAAK,SAAS,EAAE;QACxB,OAAO,EAAE,CAAC;KACX;IACD,OAAO,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE;QAClC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC;QACtB,OAAO,GAAG,CAAC;IACb,CAAC,EAAE,EAAwB,CAAC,CAAC;AAC/B,CAAC;AARD,8DAQC","sourcesContent":["import { BuildStepContext } from './BuildStepContext.js';\nimport { BuildStepRuntimeError } from './errors.js';\nimport { interpolateWithOutputs } from './utils/template.js';\n\nexport type BuildStepInputById = Record<string, BuildStepInput>;\nexport type BuildStepInputProvider = (ctx: BuildStepContext, stepId: string) => BuildStepInput;\n\ninterface BuildStepInputProviderParams {\n  id: string;\n  allowedValues?: string[];\n  defaultValue?: string;\n  required?: boolean;\n}\n\ninterface BuildStepInputParams extends BuildStepInputProviderParams {\n  stepDisplayName: string;\n}\n\nexport class BuildStepInput {\n  public readonly id: string;\n  public readonly stepDisplayName: string;\n  public readonly defaultValue?: string;\n  public readonly allowedValues?: string[];\n  public readonly required: boolean;\n\n  private _value?: string;\n\n  public static createProvider(params: BuildStepInputProviderParams): BuildStepInputProvider {\n    return (ctx, stepDisplayName) => new BuildStepInput(ctx, { ...params, stepDisplayName });\n  }\n\n  constructor(\n    private readonly ctx: BuildStepContext,\n    { id, stepDisplayName, allowedValues, defaultValue, required = true }: BuildStepInputParams\n  ) {\n    this.id = id;\n    this.stepDisplayName = stepDisplayName;\n    this.allowedValues = allowedValues;\n    this.defaultValue = defaultValue;\n    this.required = required;\n  }\n\n  public get value(): string | undefined {\n    const rawValue = this._value ?? this.defaultValue;\n    if (this.required && rawValue === undefined) {\n      throw new BuildStepRuntimeError(\n        `Input parameter \"${this.id}\" for step \"${this.stepDisplayName}\" is required but it was not set.`\n      );\n    }\n\n    if (rawValue === undefined) {\n      return rawValue;\n    } else {\n      return interpolateWithOutputs(rawValue, (path) => this.ctx.getStepOutputValue(path) ?? '');\n    }\n  }\n\n  public set(value: string | undefined): BuildStepInput {\n    if (this.required && value === undefined) {\n      throw new BuildStepRuntimeError(\n        `Input parameter \"${this.id}\" for step \"${this.stepDisplayName}\" is required.`\n      );\n    }\n    this._value = value;\n    return this;\n  }\n\n  public isValueOneOfAllowedValues(): boolean {\n    const value = this._value ?? this.defaultValue;\n    if (this.allowedValues === undefined || value === undefined) {\n      return true;\n    }\n    return this.allowedValues.includes(value);\n  }\n}\n\nexport function makeBuildStepInputByIdMap(inputs?: BuildStepInput[]): BuildStepInputById {\n  if (inputs === undefined) {\n    return {};\n  }\n  return inputs.reduce((acc, input) => {\n    acc[input.id] = input;\n    return acc;\n  }, {} as BuildStepInputById);\n}\n"]}